<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core" 
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
 	  xmlns:icecore="http://www.icefaces.org/icefaces/core" 
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
    	<h:outputStylesheet name="css/table-style.css"  />
    	<h:outputStylesheet name="css/loginhead-style.css"  />
    </h:head>
 
    <h:body>
    <h:form id="travelForm"> 
      <!--   id=<h:outputText value="#{request.getParameter('id')}" /> -->
      <!--  Pass parameter to bean
      <f:viewParam name="id" value="#{travelRou.idProfile}"/> -->
          
    	<h:panelGrid columns="2" columnClasses="top_column_left, top_column_right"  style="width: 100%">      	
      		<h:commandLink action="#{profileBean.clearData}" value="#{messagesSource.getLocaleValue
      			(&quot;navigation.back&quot;, null)}" />
      			
      		<a href="#{request.contextPath}/j_spring_security_logout">
	      		#{messagesSource.getLocaleValue("navigation.logout", null)}
	      	</a>
		</h:panelGrid>
		
		<h1 align="center"> #{messagesSource.getLocaleValue("travel.caption", null)} </h1>
		
		<h:commandButton value="#{messagesSource.getLocaleValue(&quot;travel.route&quot;, null)}" 
			action="travelroute?faces-redirect=true" style="width:150px" />
						
		<br /><br />
		
		<!--  Edit profile -->
     	<rich:panel header="#{messagesSource.getLocaleValue(&quot;travel.panel.header&quot;, null)}">
     	<h:panelGrid columns="7">
     		
			<ui:insert name="editProfile" >
	 	  		<ui:include src="templates/commonProfileEdit.xhtml" />
	   		</ui:insert>     		
			
     		<h:commandButton id="editProfile" action="#{profileBean.update}" 
		  		value="#{messagesSource.getLocaleValue(&quot;travel.save&quot;, null)}" />					
			
		</h:panelGrid>  
		</rich:panel>	
		<br />	
		
		<h:panelGrid columns="3"> 					
			<h:outputText value="#{messagesSource.getLocaleValue(&quot;travel.cost.common&quot;, null)}" 
			  			  style="font-weight:bold;color:#0000CC"/>
			<h:outputText value="#{costsBean.getSum(profileBean.idProfile)}" 
			  			  style="font-weight:bold"/>
			<h:selectOneMenu value="#{costsBean.currencySum}" 
							 onchange="submit()">
			<f:selectItems value="#{currencyServiceImpl.getList()}" 
						   var="curSum" 
			  			   itemLabel="#{curSum.name}" 
			  			   itemValue="#{curSum.value}" />
			</h:selectOneMenu>						
		</h:panelGrid>		
		
		<p:growl id="messages" showDetail="true"/>	
			
		<p:tabView id="tabTravel" rendered="#{not empty travelRouteBean.findByIdProfile()}"
								  orientation="top"
								  style="font-size:80%; font-family:Times New Roman, Times, serif;">

			<c:forEach items="#{travelRouteBean.findByIdProfile()}" var="headCity">
	        	<p:tab title="#{headCity.place.cityName}">	
	        	
					<h:panelGrid columns="3"> 					
						<h:outputText value="#{messagesSource.getLocaleValue(&quot;travel.cost&quot;, null)}" 
						  			  style="font-weight:bold;color:#0000CC"/>
						<h:outputText value="#{costsBean.getSumTravelRoute(headCity.idTravelRoute)}" 
						  			  style="font-weight:bold"/>
						<h:selectOneMenu value="#{costsBean.currencySumPlace}" 
										 onchange="submit()">
							<f:selectItems value="#{currencyServiceImpl.getList()}" 
										   var="curSumPlace" 
							  			   itemLabel="#{curSumPlace.name}" 
							  			   itemValue="#{curSumPlace.value}" />
						</h:selectOneMenu>						
					</h:panelGrid>
  	  				
					<p:dataTable 
	    	    		id="Id#{headCity.place.idPlace}" 
	    	    		value="#{costsServiceImpl.findByTravelRoute(headCity.idTravelRoute)}" 
	    	    		var="costsTable" 
	    	    		rowIndexVar="rowIndex"
	    	    		scrollable="true"
	    	    		resizableColumns="true"
	    	    		scrollRows="20"
	    	    		editable="true"
	    	    		rowKey="#{costsTable.idCosts}"
	    	    		selection="#{costsBean.costs}" selectionMode="single">	    		
						
						<p:ajax event="rowEdit" listener="#{costsBean.onEdit}" update=":travelForm:messages"  />
						<p:ajax event="rowEditCancel" listener="#{costsBean.onEditCancel}" update=":travelForm:messages" />
               			
		        		<p:column headerText="#{messagesSource.getLocaleValue(&quot;travel.number&quot;, null)}"
		        				  width="30"
		        				  style="text-align: right">
		                	<h:outputText value = "#{rowIndex+1}" />		
		        		</p:column>
		
		       			<p:column headerText="#{messagesSource.getLocaleValue(&quot;travel.costs&quot;, null)}"
		       					  width="100"
		       					  sortBy="#{costsTable.costsList.name}">  		       					  
	                    	<h:outputText value="#{costsTable.costsList.name}" />  		         		 
		        		</p:column>
		        		
		       			<p:column headerText="#{messagesSource.getLocaleValue(&quot;travel.price&quot;, null)}"
		       					  width="80"
		       					  sortBy="#{costsTable.price}"
		       					  style="text-align: right">
		       				<p:cellEditor>	
		       					<f:facet name="output">  
	                        		<h:outputText value="#{costsTable.price}" />
								</f:facet>
								
								<f:facet name="input">
		                    		<p:inputText value="#{costsBean.costs.price}"
		                        		 	 style="text-align:right; width:100%;" />
		                        </f:facet>		 	 
		                    </p:cellEditor>    		 	   
		        		</p:column>		
		        		
		       			<p:column headerText="#{messagesSource.getLocaleValue(&quot;travel.currency&quot;, null)}"
		       					  style="text-align:center" 
		       					  width="120" >
		       				<p:cellEditor>
		       					<f:facet name="output"> 	  
		                			<h:outputText value="#{costsTable.currency.value}"  />
		                        </f:facet>
		                        
		                        <f:facet name="input">  
									<h:selectOneMenu value="#{costsBean.currencyValue}" style="width:100%;">
									
										<f:selectItems value="#{currencyServiceImpl.getList()}" 
										   	   	   var="cur" 
									  	           itemLabel="#{cur.name}" 
									  	           itemValue="#{cur.value}" />
									</h:selectOneMenu>	
								</f:facet>		 
							</p:cellEditor> 	  		                          
		        		</p:column>		        				        			        	
		        		
		       			<p:column headerText="#{messagesSource.getLocaleValue(&quot;travel.note&quot;, null)}"
		       					  width="100">
		       				<p:cellEditor>	
		       				    <f:facet name="output">   
		                			<h:outputText value="#{costsTable.note}" />
		                        </f:facet>
		                        
		                        <f:facet name="input">    
		                    		<p:inputText value="#{costsBean.costs.note}" style="width:100%" />
		                    	</f:facet>	
		                    </p:cellEditor>			                          
		        		</p:column>	
		        				                
		                <p:column width="35" >  								
							<p:rowEditor />
        				</p:column>	 
        				
        				<f:facet name="footer">  
							<p:commandButton 
							    id="IdNew#{headCity.place.idPlace}" 
								icon="ui-icon-circle-plus" 
								value="#{messagesSource.getLocaleValue(&quot;common.add&quot;, null)}" 
								actionListener="#{costsBean.newData()}" 
								update=":travelForm:messages" 
								oncomplete="addDialog.show()"/>  
						</f:facet>		     			        		        		
		        		        	
			       	</p:dataTable>
			       		        	          	
	       		</p:tab>
	        </c:forEach>
	    </p:tabView>							

	    <p:dialog header="Введите данные" modal="true" widgetVar="addDialog" resizable="false">
				<h:panelGrid id="detailGrid" columns="2" style="margin-bottom:10px">
					<h:outputLabel for="costs" value="#{messagesSource.getLocaleValue(&quot;travel.costs&quot;, null)}" />
					<p:inputText id="costs" value="#{costsBean.costsList.name}"/>
									
					<h:outputLabel for="priceLabel" value="#{messagesSource.getLocaleValue(&quot;travel.price&quot;, null)}" />
					<p:inputText id="priceLabel" value="#{costsBean.costs.price}"/>			
					
					<h:outputLabel for="currency" value="#{messagesSource.getLocaleValue(&quot;travel.currency&quot;, null)}" />
					<h:selectOneMenu id="currency" value="#{costsBean.currencyValue}">
						<f:selectItems value="#{currencyServiceImpl.getList()}" 
									   var="cur" 
									   itemLabel="#{cur.name}" 
									   itemValue="#{cur.value}" />
					</h:selectOneMenu>	
					
					<h:outputLabel for="note" value="#{messagesSource.getLocaleValue(&quot;travel.note&quot;, null)}" />
					<p:inputText id="note" value="#{costsBean.costs.note}"/>																										
				</h:panelGrid>
				
				<p:commandButton 
					id="submitButton"
					icon="ui-icon-disk" 
					value="#{messagesSource.getLocaleValue(&quot;common.save&quot;, null)}" 
					actionListener="#{costsBean.add}" 
					update=":travelForm:messages, tabTravel" 
					oncomplete="addDialog.hide()"/>
		</p:dialog>	
		    
    </h:form>
    </h:body>
</html>         