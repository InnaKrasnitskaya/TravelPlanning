<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jsp/jstl/core" 
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
 	  xmlns:icecore="http://www.icefaces.org/icefaces/core" 
      xmlns:a4j="http://richfaces.org/a4j">
    <h:head>
    	<h:outputStylesheet name="css/table-style.css"  />
    	<h:outputStylesheet name="css/loginhead-style.css"  />
    </h:head>
 
    <h:body>
    <h:form> 
      <!--   id=<h:outputText value="#{request.getParameter('id')}" /> -->
      <!--  Pass parameter to bean
      <f:viewParam name="id" value="#{travelRou.idProfile}"/> -->
          
    	<h:panelGrid columns="2" columnClasses="top_column_left, top_column_right"  style="width: 100%">      	
      		<h:commandLink action="#{profileBean.clearData}" value="#{messagesSource.getLocaleValue
      			(&quot;navigation.back&quot;, null)}" />
      			
      		<a href="#{request.contextPath}/j_spring_security_logout">
	      		#{messagesSource.getLocaleValue("navigation.logout", null)}
	      	</a>
		</h:panelGrid>
		
		<h1 align="center"> #{messagesSource.getLocaleValue("travel.caption", null)} </h1>
		
		<h:commandButton value="#{messagesSource.getLocaleValue(&quot;travel.route&quot;, null)}" 
			action="travelroute?faces-redirect=true" style="width:150px" />
						
		<br /><br />
		
		<!--  Edit profile -->
     	<rich:panel header="#{messagesSource.getLocaleValue(&quot;travel.panel.header&quot;, null)}">
     	<h:panelGrid columns="7">	

     		<h:outputText  value="#{messagesSource.getLocaleValue(&quot;travel.edit.label&quot;, null)}"/>
     		<h:inputText id="editProfileLabel" size="20" value="#{profileBean.name}"/>
			
			<h:outputText  value="#{messagesSource.getLocaleValue(&quot;profile.period.start&quot;, null)}" />		  		
		  	<rich:calendar cellWidth="24px" cellHeight="22px" value="#{profileBean.startDate}"
				datePattern="dd.MM.yyyy" style="width:200px;" popup="true">
			</rich:calendar>
			
			<h:outputText  value="#{messagesSource.getLocaleValue(&quot;profile.period.end&quot;, null)}" />	
		  	<rich:calendar cellWidth="24px" cellHeight="22px" value="#{profileBean.endDate}"
				datePattern="dd.MM.yyyy" style="width:200px;" popup="true">
			</rich:calendar>	
			
     		<h:commandButton id="editProfile" action="#{profileBean.update}" 
		  		value="#{messagesSource.getLocaleValue(&quot;travel.save&quot;, null)}" />					
			
		</h:panelGrid>  
		</rich:panel>	
		<br />	
		
		<h:panelGrid columns="3"> 					
			<h:outputText value="#{messagesSource.getLocaleValue(&quot;travel.cost.common&quot;, null)}" 
			  style="font-weight:bold;color:#0000CC"/>
			<h:outputText value="#{costsBean.getSum(profileBean.idProfile)}" 
			  style="font-weight:bold"/>
			<h:selectOneMenu value="#{costsBean.currencySum}" onchange="submit()">
			<f:selectItems value="#{currencyServiceImpl.getList()}" var="curSum" 
			  itemLabel="#{curSum.name}" itemValue="#{curSum.value}" />
			</h:selectOneMenu>						
		</h:panelGrid>			
			
		<rich:tabPanel id="tabTravel" switchType="ajax" rendered="#{not empty travelRouteBean.findByIdProfile()}">

			<c:forEach items="#{travelRouteBean.findByIdProfile()}" var="headCity">
	        	<rich:tab header="#{headCity.place.cityName}">	
	        	
					<h:panelGrid columns="3"> 					
						<h:outputText value="#{messagesSource.getLocaleValue(&quot;travel.cost&quot;, null)}" 
						  style="font-weight:bold;color:#0000CC"/>
						<h:outputText value="#{costsBean.getSumTravelRoute(headCity.idTravelRoute)}" 
						  style="font-weight:bold"/>
						<h:selectOneMenu value="#{costsBean.currencySumPlace}" onchange="submit()">
							<f:selectItems value="#{currencyServiceImpl.getList()}" var="curSumPlace" 
							  itemLabel="#{curSumPlace.name}" itemValue="#{curSumPlace.value}" />
						</h:selectOneMenu>						
					</h:panelGrid>		        	  
	        	          	
	    	    	<rich:dataTable 
	    	    		id="Id#{headCity.place.idPlace}" 
	    	    		rendered="#{not empty costsServiceImpl.findByTravelRoute(headCity.idTravelRoute)}"
	    	    		value="#{costsServiceImpl.findByTravelRoute(headCity.idTravelRoute)}" 
	    	    		var="costsTable" 
	    	    		rows="10" rowKeyVar="rowkey"
	    	    		columnClasses="column-right,none,column-right,none">	    		
	
		        		<rich:column>
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.number", null)}
		                	</f:facet>
		                		<h:outputText value = "#{rowkey + 1}" rendered="#{costsTable.idCosts != null 
		                		  or costsBean.prAdd == true}" />		
		        		</rich:column>
		
		       			<rich:column>
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.costs", null)}
		                	</f:facet>
		                        <h:outputText value="#{costsTable.costsList.name}" 
		                          rendered="#{costsTable.idCosts != null}"/>
		                          
		                        <h:inputText value="#{costsBean.name}" 
		                          rendered="#{costsTable.idCosts == null and costsBean.prAdd == true}" />
		        		</rich:column>
		        		
		       			<rich:column>
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.price", null)}
		                	</f:facet>
		                        <h:outputText value="#{costsTable.price}" 
		                          rendered="#{costsTable.idCosts != null and
		                            costsTable.idCosts != costsBean.idUpdatedCosts}" />

		                        <h:inputText value="#{costsBean.price}"
		                          rendered="#{(costsTable.idCosts != null and costsTable.idCosts == costsBean.idUpdatedCosts) 
		                            or (costsTable.idCosts == null and costsBean.prAdd == true)}" 
		                          style="text-align:right" />  
		        		</rich:column>		
		        		
		       			<rich:column style="text-align:center">
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.currency", null)}
		                	</f:facet>
		                        <h:outputText value="#{costsTable.currency.value}" 
		                          rendered="#{costsTable.idCosts != null and
		                          costsTable.idCosts != costsBean.idUpdatedCosts}"  />
		                          
								<h:selectOneMenu value="#{costsBean.currencyValue}"
								  rendered="#{(costsTable.idCosts == null and costsBean.prAdd == true)
								    or (costsTable.idCosts != null and costsTable.idCosts == costsBean.idUpdatedCosts)}">
									
									<f:selectItems value="#{currencyServiceImpl.getList()}" var="cur" 
									  itemLabel="#{cur.name}" itemValue="#{cur.value}" />
								</h:selectOneMenu>		   		                          
		        		</rich:column>		        				        			        	
		        		
		       			<rich:column>
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.note", null)}
		                	</f:facet>
		                        <h:outputText value="#{costsTable.note}" 
		                          rendered="#{costsTable.idCosts != null and
		                            costsTable.idCosts != costsBean.idUpdatedCosts}" />
		                            
		                        <h:inputText value="#{costsBean.note}" 
		                          rendered="#{(costsTable.idCosts == null and costsBean.prAdd == true)
		                            or (costsTable.idCosts != null and costsTable.idCosts == costsBean.idUpdatedCosts)}" />		                          
		        		</rich:column>	
		        		
		       			<rich:column>
		                	<f:facet name="header">
		                		#{messagesSource.getLocaleValue("travel.parameters", null)}
		                	</f:facet>
		                	<h:panelGrid columns="2"> 
		                		<h:commandLink action="#{costsBean.update(costsTable.idCosts)}" 
		                	  	  rendered="#{costsTable.idCosts != null}" 
		                	  	  value="#{messagesSource.getLocaleValue(&quot;travel.edit.costs&quot;, null)}" />
		                	  	  
		                		<h:commandLink rendered="#{costsTable.idCosts != null}" 
		                		  value="#{messagesSource.getLocaleValue(&quot;travel.delete.costs&quot;, null)}" 
		                		  action="#{costsServiceImpl.remove(costsTable.idCosts)}" />  
		                	</h:panelGrid> 
		                </rich:column>		        			        		        		
		        		
						<f:facet name="footer">
		                	<rich:dataScroller align="left" 
		                	  for="Id#{headCity.place.idPlace}" maxPages="20" />
								<h:commandButton action="#{costsBean.add}" value="Add" style="width:50px;height:24px;"/> 
								<h:commandButton action="#{costsBean.save(headCity.idTravelRoute)}"
							  		value="Save" style="width:50px;height:24px;"  />		
		                </f:facet>		        		
			       	</rich:dataTable>	

	       		</rich:tab>
	        </c:forEach>
	    </rich:tabPanel>	

    </h:form>
    </h:body>
</html>         